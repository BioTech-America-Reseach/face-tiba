<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zodiac Bio-Scanner ¬∑ Kituo cha Afya</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: linear-gradient(145deg, #0a1928 0%, #1a3344 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 16px;
        }

        .app-container {
            max-width: 480px;
            width: 100%;
            background: rgba(10, 25, 40, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 255, 255, 0.25);
            border-radius: 48px;
            padding: 24px;
            box-shadow: 0 30px 60px rgba(0, 20, 30, 0.8), 0 0 0 2px rgba(0, 255, 255, 0.1) inset;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 28px;
            position: relative;
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #a0f0ff, #70ffd0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 1px;
        }

        .device-id {
            font-size: 0.75rem;
            color: #4a9ea0;
            background: rgba(0, 255, 255, 0.1);
            padding: 6px 16px;
            border-radius: 40px;
            display: inline-block;
            margin-top: 8px;
            border: 1px solid #2f6f7a;
            font-family: monospace;
        }

        /* Admin Login Toggle */
        .admin-section {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 16px;
        }
        .admin-btn {
            background: transparent;
            border: 1px solid #00f2ff;
            color: #00f2ff;
            padding: 8px 16px;
            border-radius: 40px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: 0.2s;
        }
        .admin-btn:hover {
            background: #00f2ff20;
        }
        .admin-panel {
            background: #102530;
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid #00f2ff;
        }
        .admin-panel input {
            background: #1f3a48;
            border: 1px solid #00f2ff;
            color: white;
            padding: 12px;
            border-radius: 40px;
            width: 100%;
            margin-bottom: 10px;
        }
        .flex-row {
            display: flex;
            gap: 10px;
        }

        /* Card Style */
        .card {
            background: rgba(20, 40, 55, 0.7);
            border-radius: 32px;
            padding: 24px;
            border: 1px solid #2e5f6b;
            box-shadow: 0 15px 30px -10px black;
            margin-bottom: 20px;
            transition: 0.3s;
        }

        .hidden {
            display: none !important;
        }

        /* Inputs */
        input {
            width: 100%;
            padding: 16px 20px;
            background: #0f212e;
            border: 2px solid #2b5e6b;
            border-radius: 60px;
            font-size: 1rem;
            color: white;
            outline: none;
            transition: 0.2s;
            margin-bottom: 16px;
        }

        input:focus {
            border-color: #00f2ff;
            box-shadow: 0 0 15px #00f2ff80;
        }

        input::placeholder {
            color: #80b8c0;
        }

        /* Button */
        .btn {
            background: linear-gradient(145deg, #00e0ff, #0099cc);
            border: none;
            padding: 16px 24px;
            border-radius: 60px;
            font-weight: 700;
            font-size: 1.1rem;
            color: #0a1928;
            width: 100%;
            cursor: pointer;
            transition: 0.2s;
            border: 1px solid #80ffff;
            box-shadow: 0 8px 0 #006080, 0 10px 20px black;
        }

        .btn:active {
            transform: translateY(5px);
            box-shadow: 0 3px 0 #006080, 0 10px 20px black;
        }

        .btn.secondary {
            background: transparent;
            color: #00f2ff;
            border: 2px solid #00f2ff;
            box-shadow: none;
        }

        .btn.secondary:active {
            transform: translateY(2px);
        }

        .btn.small {
            padding: 10px 16px;
            font-size: 0.9rem;
        }

        /* Profile Lock */
        .profile-card {
            background: linear-gradient(145deg, #0b2c3b, #05222e);
            border-radius: 28px;
            padding: 20px;
            border: 2px solid #00f2ff;
            position: relative;
            overflow: hidden;
        }

        .profile-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, #00f2ff20, transparent 70%);
            animation: rotate 10s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .profile-name {
            font-size: 1.8rem;
            font-weight: 700;
            color: #00f2ff;
            text-shadow: 0 0 10px cyan;
            position: relative;
        }

        .profile-year {
            color: #b0f0ff;
            margin-bottom: 20px;
            position: relative;
        }

        /* Camera Wrapper */
        .camera-container {
            position: relative;
            width: 100%;
            aspect-ratio: 1/1;
            border-radius: 40px;
            overflow: hidden;
            border: 3px solid #00f2ff;
            box-shadow: 0 0 30px #00f2ff;
            margin: 20px 0;
            background: black;
        }

        video, canvas {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .laser-line {
            position: absolute;
            width: 100%;
            height: 4px;
            background: #00f2ff;
            box-shadow: 0 0 30px cyan, 0 0 60px blue;
            top: 0;
            left: 0;
            z-index: 20;
            animation: scanMove 2s infinite ease-in-out;
        }

        @keyframes scanMove {
            0% { top: 0; }
            50% { top: calc(100% - 4px); }
            100% { top: 0; }
        }

        .scan-status {
            text-align: center;
            color: #00f2ff;
            font-weight: 600;
            margin: 10px 0;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* Results */
        .results-card {
            background: white;
            border-radius: 32px;
            padding: 24px;
            color: #0a1928;
            max-height: 80vh;
            overflow-y: auto;
        }

        .zodiac-badge {
            background: #00c8ff;
            color: #021016;
            padding: 12px 24px;
            border-radius: 60px;
            font-weight: 800;
            font-size: 1.6rem;
            display: inline-block;
            margin: 10px 0;
        }

        .risk-title {
            color: #d32f2f;
            font-weight: 800;
            font-size: 1.2rem;
            margin-top: 20px;
            border-left: 8px solid #d32f2f;
            padding-left: 12px;
        }

        .risk-list {
            list-style: none;
            margin: 10px 0;
        }

        .risk-list li {
            background: #ffeaea;
            padding: 12px 18px;
            border-radius: 20px;
            margin-bottom: 8px;
            border-left: 5px solid #f44336;
            font-weight: 500;
        }

        .medicine-box {
            background: #e0f7fa;
            border-radius: 20px;
            padding: 16px;
            margin: 16px 0;
            border-left: 8px solid #0077be;
            text-align: left;
        }

        .medicine-box h4 {
            color: #01579b;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .medicine-box p {
            white-space: pre-line; /* Ruhusu mistari mipya na bullet points */
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .food-tip {
            background: #1b5e20;
            color: white;
            padding: 18px;
            border-radius: 24px;
            margin: 20px 0;
            font-size: 1.1rem;
            text-align: left;
            border: 2px solid #a5d6a7;
            white-space: pre-line;
        }

        .download-btn {
            background: #2e7d32;
            border: none;
            color: white;
            padding: 14px;
            border-radius: 60px;
            font-weight: 600;
            width: 100%;
            margin-top: 10px;
            cursor: pointer;
            border: 1px solid #a5d6a7;
        }

        .admin-badge {
            background: #ffb74d;
            color: #1a1a1a;
            padding: 4px 12px;
            border-radius: 40px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 10px;
        }

        .disclaimer {
            font-size: 0.7rem;
            color: #6b8e9c;
            text-align: center;
            margin-top: 16px;
        }
    </style>
</head>
<body>
<div class="app-container" id="app">
    
    <!-- Header -->
    <div class="header">
        <h1>‚öïÔ∏èZODIAC BIO-SCAN</h1>
        <div class="device-id" id="deviceId">üî¨ DEVICE: LOADING...</div>
    </div>

    <!-- Admin Toggle (small button) -->
    <div class="admin-section">
        <span class="admin-btn" id="adminToggleBtn">üë§ ADMIN</span>
    </div>

    <!-- Admin Login Panel (hidden by default) -->
    <div id="adminPanel" class="admin-panel hidden">
        <input type="password" id="adminCode" placeholder="üîê Weka code ya siri">
        <div class="flex-row">
            <button class="btn small" id="adminLoginBtn">INGIA KAMA ADMIN</button>
            <button class="btn secondary small" id="adminLogoutBtn">TOKA</button>
        </div>
        <p id="adminStatus" style="color:#ffb74d; font-size:0.8rem; margin-top:8px;"></p>
    </div>

    <!-- USajili (Registration) -->
    <div id="registrationSection" class="card">
        <h3 style="color:#a0f0ff; margin-bottom: 16px;">üìã SAJILI KIFAA</h3>
        <p style="color:#b0d0d0; margin-bottom: 16px;">Ingiza taarifa zako ili kukifunga kifaa kwako.</p>
        <input type="text" id="regName" placeholder="Jina lako kamili" autocomplete="off">
        <input type="number" id="regYear" placeholder="Mwaka wa kuzaliwa (mfano: 1995)" min="1900" max="2100">
        <button class="btn" id="registerBtn">üîí SAJILI NA FUNGA KIFAA</button>
    </div>

    <!-- Profile Locked (Baada ya kusajili) -->
    <div id="profileSection" class="profile-card hidden">
        <div style="position: relative; z-index: 2;">
            <div style="font-size: 0.9rem; color: #80e0ff;">üÜî KITAMBULISHO KIMEFUNGWA</div>
            <div class="profile-name" id="profileName">-</div>
            <div class="profile-year" id="profileYear">-</div>
            <!-- Admin badge itaonekana kama ni admin -->
            <div id="adminBadge" class="admin-badge hidden">üëë ADMIN MODE</div>
            <!-- Kitufe cha Scan kitaonekana kulingana na ruhusa -->
            <button class="btn" id="startScanBtn">üì∏ ANZA SCAN YA USO</button>
            <button class="btn secondary" id="resetBtn" style="margin-top: 10px;">üîÑ BADILISHA MTUMIAJI</button>
            <!-- Onyo kwa user aliyeisha scan -->
            <p id="scanLimitMsg" style="color: #ffaa66; margin-top: 12px; font-size:0.9rem; display: none;">‚úîÔ∏è Umepiga scan moja. Ikiwa unahitaji nyingine, ingia kama admin.</p>
        </div>
    </div>

    <!-- Camera + Scan -->
    <div id="cameraSection" class="hidden">
        <div class="camera-container" id="cameraContainer">
            <video id="video" autoplay playsinline></video>
            <canvas id="canvas" style="display: none;"></canvas>
            <div id="laserLine" class="laser-line" style="display: none;"></div>
        </div>
        <div id="scanStatus" class="scan-status"></div>
        <button class="btn" id="captureBtn">üì∑ PIGA SELFI</button>
        <button class="btn secondary" id="cancelCameraBtn" style="margin-top: 10px;">‚úñÔ∏è GHARI</button>
    </div>

    <!-- Matokeo (Results) -->
    <div id="resultsSection" class="hidden">
        <div class="results-card">
            <div style="text-align: center;">
                <div style="font-size: 1rem; color: #0288d1;">RIPOTI YA ZODIAC</div>
                <div class="zodiac-badge" id="resultZodiac">-</div>
            </div>

            <div class="risk-title">üö® MAGONJWA YANAYOWEZA KUKUFIKIA</div>
            <ul class="risk-list" id="diseaseList"></ul>

            <div class="medicine-box">
                <h4>üåø DAWA ZA KICHINA (HERBAL)</h4>
                <p id="chinaMeds"></p>
            </div>

            <div class="medicine-box">
                <h4>üíä DR. WILLIAM CLINIC</h4>
                <p id="williamMeds"></p>
            </div>

            <div class="medicine-box">
                <h4>üå± TIBA YA NYUMBANI (MIMEA NA JUICI)</h4>
                <p id="herbMeds"></p>
            </div>

            <div class="food-tip" id="foodTip"></div>

            <!-- Download Report Button -->
            <button class="download-btn" id="downloadReportBtn">üì• PAKUA RIPOTI (TXT)</button>

            <!-- Vitufe vya urambazaji -->
            <button class="btn secondary" id="newScanBtn" style="margin-top: 16px;">üîÑ FANYA SCAN MPYA</button>
            <button class="btn secondary" id="homeBtn" style="margin-top: 10px;">üè† NYUMBANI</button>
        </div>
    </div>

    <div class="disclaimer">
        ‚öïÔ∏è DAWA ZA DOCTOR WILLIAM UNAAGIZA KUPITIA MAWAKALA WAKE.
    </div>
</div>

<script>
    (function() {
        // ---------- Database ya Zodiac (imepanuliwa kwa kina hadi pointi 30+) ----------
        const zodiacData = {
            "Panya": {
                diseases: [
                    "Shinikizo la damu (hypertension)",
                    "Maumivu ya kichwa (migraine)",
                    "Kukosa usingizi (insomnia)",
                    "Mzio wa ngozi na msimu",
                    "Uchovu wa macho (digital strain)",
                    "Kizunguzungu (vertigo)",
                    "Wasiwasi (anxiety)",
                    "Kupoteza kumbukumbu",
                    "Kuvimba kwa miguu",
                    "Kikohozi kavu",
                    "Kuhara kwa msongo",
                    "Maumivu ya tumbo la chungu",
                    "Homa za msimu",
                    "Upungufu wa damu (anemia)",
                    "Ngozi kuwasha"
                ],
                chinaMeds: `üåø **DAWA ZA KICHINA KWA PANYA** (Vidokezo 30+)

1. Ginseng (‰∫∫ÂèÇ) ‚Äì Kipimo: vidonge 2 asubuhi na jioni. Huongeza nishati na kinga.
2. Shan Zha (Â±±Ê•Ç) ‚Äì Kuchukwa pamoja na Ginseng. Husaidia mzunguko wa damu na kupunguza shinikizo.
3. Tian Ma (Â§©È∫ª) ‚Äì Kwa maumivu ya kichwa na kizunguzungu; vidonge 1 asubuhi.
4. Suan Zao Ren (ÈÖ∏Êû£‰ªÅ) ‚Äì Kwa usingizi mbaya; vidonge 2 jioni kabla ya kulala.
5. Ju Hua (ËèäËä±) ‚Äì Kwa macho kuchoka; tengeneza chai na kunywa mara 2 kwa siku.
6. Huang Qi (ÈªÑËä™) ‚Äì Kuimarisha kinga; vidonge 2 kwa siku.
7. Dang Gui (ÂΩìÂΩí) ‚Äì Kusafisha damu na kupunguza mzio.
8. Bai Zhi (ÁôΩËä∑) ‚Äì Kwa maumivu ya kichwa na sinus.
9. Chuan Xiong (Â∑ùËäé) ‚Äì Kuchochea mzunguko wa damu; kuchukwa pamoja na Dang Gui.
10. Fu Ling (ËåØËãì) ‚Äì Kuondoa maji mwilini na kupunguza uvimbe.
11. Ze Xie (Ê≥ΩÊ≥ª) ‚Äì Kwa shinikizo la damu na cholesterol.
12. Gou Qi Zi (Êû∏ÊùûÂ≠ê) ‚Äì Kulisha macho na ini; vidonge 2 kwa siku.
13. He Huan Pi (ÂêàÊ¨¢ÁöÆ) ‚Äì Kutuliza wasiwasi na usingizi.
14. Yuan Zhi (ËøúÂøó) ‚Äì Kuboresha kumbukumbu na kutuliza akili.
15. Bai Shao (ÁôΩËäç) ‚Äì Kupunguza maumivu na wasiwasi.
16. Sheng Di Huang (ÁîüÂú∞ÈªÑ) ‚Äì Kusafisha damu na kupunguza homa za ndani.
17. Xuan Shen (ÁéÑÂèÇ) ‚Äì Kwa koo kavu na kikohozi.
18. Jie Geng (Ê°îÊ¢ó) ‚Äì Kutoa makohozi na kutuliza koo.
19. Chen Pi (ÈôàÁöÆ) ‚Äì Kwa tumbo la chungu na gesi.
20. Mai Ya (È∫¶ËäΩ) ‚Äì Kuboresha mmeng'enyo wa chakula.
21. Gu Ya (Ë∞∑ËäΩ) ‚Äì Kwa hamu ya kula na kuvimba tumbo.
22. Shen Qu (Á•ûÊõ≤) ‚Äì Mchanganyiko wa mimea kwa utumbo.
23. Da Huang (Â§ßÈªÑ) ‚Äì Kusafisha utumbo (kwa muda mfupi tu).
24. Huang Lian (ÈªÑËøû) ‚Äì Kuua bakteria na kupunguza homa.
25. Jin Yin Hua (ÈáëÈì∂Ëä±) ‚Äì Kwa homa na maambukizi ya ngozi.
26. Lian Qiao (ËøûÁøò) ‚Äì Pamoja na Jin Yin Hua kwa homa.
27. Ban Lan Gen (ÊùøËìùÊ†π) ‚Äì Kuzuia mafua na homa.
28. Da Qing Ye (Â§ßÈùíÂè∂) ‚Äì Kwa homa na maumivu ya koo.
29. She Gan (Â∞ÑÂπ≤) ‚Äì Kwa kikohozi na koo kuvimba.
30. Ma Huang (È∫ªÈªÑ) ‚Äì Kwa mafua na kikohozi (tahadhari kwa shinikizo).
31. Ku Ding Cha (Ëã¶‰∏ÅËå∂) ‚Äì Chai ya kutuliza shinikizo na cholesterol.

**Mchanganyiko maalum:** Ginseng + Shan Zha + Tian Ma (2:2:1) kwa shinikizo na maumivu ya kichwa. Chukua kwa siku 21, pumzika siku 7, kisha rudia.

**Tahadhari:** Usichukue Ginseng ikiwa una shinikizo la damu lisilodhibitiwa. Epuka Dang Gui wakati wa hedhi nzito.`,
                
                williamMeds: `üíä **DAWA ZA DR. WILLIAM KWA PANYA** (Maelezo 30+)

1. William's Calm Tabs ‚Äì Vidonge 2 kwa siku (asubuhi na jioni). Ina valerian, chamomile, na passiflora kutuliza usingizi na wasiwasi.
2. Hypertension Control Caps ‚Äì Kwa shinikizo la damu; kidonge 1 asubuhi.
3. Migraine Relief Spray ‚Äì Kunyunyizia paji la uso na shingo wakati wa maumivu.
4. Allergy Guard Syrup ‚Äì Kijiko 1 kwa siku kwa mzio wa msimu.
5. Eye Strain Drops ‚Äì Matone ya macho yenye euphrasia na chamomile; tone 1 kwa jicho mara 2.
6. Digestive Bitters ‚Äì Kijiko 1 kabla ya chakula kusaidia mmeng'enyo.
7. Energy Boost Complex ‚Äì Virutubisho vya B-complex na ginseng; kidonge 1 asubuhi.
8. Sleep Well Melatonin ‚Äì 3mg jioni kabla ya kulala.
9. Anxiety Relief Gummies ‚Äì 2 gummies kwa siku kwa wasiwasi.
10. Memory Focus Pills ‚Äì Ginkgo biloba + bacopa; kidonge 1 asubuhi na jioni.
11. Joint Ease Cream ‚Äì Kwa maumivu ya viungo; paka mara 2.
12. Immune Shield Syrup ‚Äì Kijiko 1 kwa siku kuimarisha kinga.
13. Cold & Flu Formula ‚Äì Kwa homa na mafua; vidonge 4 kwa siku.
14. Cough Syrup (Honey & Ivy) ‚Äì Kijiko 1 kila baada ya masaa 4.
15. SinuClear Caps ‚Äì Kwa sinus na msongamano wa pua.
16. Blood Sugar Balance ‚Äì Kwa sukari; kidonge 1 kabla ya chakula.
17. Cholesterol Guard ‚Äì Pamoja na omega-3; kidonge 1 kwa siku.
18. Liver Detox Tabs ‚Äì Kusafisha ini; vidonge 2 jioni.
19. Kidney Cleanse Drops ‚Äì Tone 10 kwenye maji asubuhi.
20. Skin Repair Cream ‚Äì Aloe vera na calendula; paka kwenye ngozi kavu.
21. Anti-itch Balm ‚Äì Kwa ngozi kuwasha na mzio.
22. Foot Soak Salt ‚Äì Loweka miguu kwenye maji ya joto na chumvi.
23. Relaxing Tea (Chamomile) ‚Äì Kunywa jioni.
24. Energy Tea (Green tea + Ginseng) ‚Äì Asubuhi.
25. Probiotic Complex ‚Äì Kwa afya ya utumbo; kidonge 1 kwa siku.
26. Magnesium Glycinate ‚Äì Kwa usingizi na misuli; vidonge 2 jioni.
27. Omega-3 Fish Oil ‚Äì Kwa moyo na ubongo; kidonge 1 kwa siku.
28. Vitamin D3 ‚Äì 2000IU kwa siku.
29. Iron Plus ‚Äì Kwa upungufu wa damu; kidonge 1 kwa siku (pamoja na chakula).
30. Multivitamin Men/Women ‚Äì Lishe kamili.

**Mchanganyiko wa dawa:** Calm Tabs + Sleep Well Melatonin kwa usingizi mkubwa. Hypertension Control + Omega-3 kwa shinikizo.`,
                
                herbMeds: `üå± **TIBA YA NYUMBANI NA JUICI KWA PANYA** (Pointi 30+)

1. Tangawizi na asali ya mwitu ‚Äì Changanya kijiko 1 cha tangawizi safi iliyokunwa na kijiko 1 cha asali kwenye maji ya joto. Kunywa asubuhi na jioni.
2. Chai ya mchaichai (moringa) ‚Äì Majani makavu au safi, chemsha kwa dakika 5. Kunywa vikombe 2 kwa siku.
3. Juisi ya karoti, tangawizi na machungwa ‚Äì Safisha damu na kuongeza vitamini A.
4. Juisi ya nanasi na mint ‚Äì Husaidia mmeng'enyo na kupunguza kuvimba.
5. Shada manii (ocimum) ‚Äì Kwa mzio na ngozi kuwasha; saga na paka au kunywa kama chai.
6. Mwarobaini (neem) ‚Äì Chemsha majani, kunywa kusafisha damu na kuua vimelea.
7. Mdalasini na asali ‚Äì Kijiko 1 asubuhi kupunguza sukari na cholesterol.
8. Chai ya chamomile ‚Äì Kutuliza usingizi na wasiwasi.
9. Chai ya lavender ‚Äì Kunywa jioni kutuliza mishipa.
10. Juisi ya mbogamboga (spinachi, celery, tango) ‚Äì Kwa shinikizo la damu.
11. Maji ya nazi (dafu) ‚Äì Electrolytes asilia; kunywa kikombe 1 kwa siku.
12. Chai ya tangawizi na ndimu ‚Äì Kwa homa na kikohozi.
13. Vitunguu saumu ‚Äì Kula kipande 1 kwa siku (au kusaga kwenye chakula) kupunguza shinikizo.
14. Kitunguu maji (red onion) ‚Äì Kula katika kachumbari kwa kinga.
15. Pilipili hoho ‚Äì Ina vitamini C; kula mbichi kwenye saladi.
16. Papai (pawpaw) ‚Äì Kwa mmeng'enyo na ngozi.
17. Ndizi ‚Äì Kwa potasiamu na usingizi.
18. Tufaha ‚Äì Kula tufaha 1 kwa siku kwa afya ya moyo.
19. Machungwa ‚Äì Vitamini C.
20. Embe ‚Äì Beta-carotene.
21. Maji ya chumvi kali (gargle) ‚Äì Kwa koo kuwasha.
22. Kula uji wa mtama ‚Äì Kwa nishati na nyuzinyuzi.
23. Mbegu za mboga (pumpkin seeds) ‚Äì Kwa magnesiamu na usingizi.
24. Karanga (almonds, walnuts) ‚Äì Kwa omega-3 na nishati.
25. Mafuta ya zeituni ‚Äì Kwa saladi na kupikia.
26. Mafuta ya nazi ‚Äì Kwa kupikia na kutengeneza dawa za ngozi.
27. Chai ya kunde (cassia) ‚Äì Kwa ngozi na kusafisha damu.
28. Majani ya mbwembwe (bitter lettuce) ‚Äì Kwa usingizi.
29. Mchicha ‚Äì Kwa chuma na vitamini.
30. Kabichi ‚Äì Kwa vidonda vya tumbo na kuvimba.

**Mchanganyiko maalum:** Juisi ya karoti + tangawizi + machungwa (1:1:1) kunywa kila asubuhi. Chai ya mwarobaini + shada manii (2:1) kwa mzio mkali.`,
                
                food: `üçΩÔ∏è **LISHE BORA NA DESTURI ZA PANYA** (Maelekezo 30+)

‚úÖ **VYAKULA VYA KULA:**
1. Wali kahawia ‚Äì Una magnesiamu na nyuzinyuzi.
2. Mboga za majani (spinachi, sukumawiki, kabichi) ‚Äì Kwa shinikizo na damu.
3. Samaki (dagaa, jodari, kambale) ‚Äì Omega-3 kwa moyo na ubongo.
4. Matunda (ndizi, parachichi, tufaha) ‚Äì Potasiamu na vitamini.
5. Karanga (almonds, walnuts) ‚Äì Kwa nishati na usingizi.
6. Mafuta ya zeituni ‚Äì Kwa saladi.
7. Nyama konda (kuku, sungura) ‚Äì Protini nyepesi.
8. Mayai ya kienyeji ‚Äì Vitamini D na B12.
9. Uji wa mtama au ulezi ‚Äì Kwa asubuhi.
10. Mboga za jamii ya kunde (dengu, maharage) ‚Äì Kwa nyuzinyuzi.
11. Viazi vitamin ‚Äì Beta-carotene.
12. Tangawizi na kitunguu saumu ‚Äì Kwenye chakula.
13. Mchicha ‚Äì Kwa chuma.
14. Broccoli ‚Äì Antioxidants.
15. Pilipili hoho ‚Äì Vitamini C.

‚ùå **VYAKULA VYA KUEPUKA:**
16. Vyakula vya kukaanga (kama chips, kuku wa kukaanga)
17. Chumvi nyingi (epuka vyakula vya kusindika)
18. Sukari (soda, peremende, keki)
19. Unga mweupe (mkate mweupe, chapati za kawaida)
20. Nyama nyekundu (ng'ombe, kondoo) kwa kiasi
21. Mafuta ya kuchoma (margarine, mafuta ya kawaida)
22. Pombe (huongeza shinikizo)
23. Kahawa nyingi (hukosesha usingizi)
24. Vinywaji vya baridi (soda)
25. Maziwa yote (kwa baadhi wana mzio)

üç≤ **MFANO WA CHAKULA CHA SIKU MOJA:**
26. Asubuhi: Uji wa mtama + parachichi + chai ya tangawizi.
27. Mchana: Wali kahawia + samaki wa kuoka + mboga za majani.
28. Jioni: Supu ya mboga (karoti, viazi vitamin, kitunguu) + ndizi.
29. Kabla ya kulala: Chai ya chamomile au maziwa ya joto.
30. Kati ya chakula: Tunda (tufaha au machungwa) au karanga.

üßò **DESTURI NA TABIA:**
31. Tembea kwa dakika 30 kila siku ‚Äì husaidia shinikizo na usingizi.
32. Epuka kukaa kwa muda mrefu kwenye simu au kompyuta ‚Äì pumzisha macho kila dakika 20.
33. Lala mapema na amka mapema ‚Äì usingizi wa masaa 7-8.
34. Fanya mazoezi ya kupumua (pranayama) kutuliza mfumo wa neva.
35. Pata jua asubuhi kwa dakika 15 kupata vitamini D.
36. Epuka msongo kwa kusoma au kusikiliza muziki wa utulivu.
37. Kaa na marafiki au familia ‚Äì mazungumzo hupunguza wasiwasi.
38. Fanya shughuli za kujitafutia furaha (kupika, bustani, n.k.)
39. Nyunyiza mafuta ya lavender kwenye mto kabla ya kulala.
40. Tembea kwenye mazingira ya asili (bustani, msitu) wikendi.`
            },
            // Hapa ungeweka data kwa Ng'ombe, Simba, Sungura, Joka, Nyoka, Farasi, Mbuzi, Kima, Jogoo, Mbwa, Nguruwe kwa mtindo uleule.
            // Kwa ufupi nimeandika Panya pekee, lakini kwenye mfumo kamili itakuwa na wanyama wote 12 kwa maelezo sawa.
            // Ukihitaji data ya wengine, naomba niiandike kwa ujumbe tofauti.
            "Ng'ombe": {
                diseases: [
                    "Maumivu ya viungo (arthritis)",
                    "Uchovu sugu",
                    "Kuvimba tumbo (bloating)",
                    "Sukari (diabetes)",
                    "Mafua ya msimu",
                    "Maumivu ya mgongo",
                    "Ngozi kukauka",
                    "Kupoteza uzito",
                    "Kuhara",
                    "Minyoo",
                    "Homa ya mwili",
                    "Kikohozi cha mzio",
                    "Shinikizo la damu",
                    "Ugonjwa wa figo (kidney issues)",
                    "Maumivu ya misuli"
                ],
                chinaMeds: `üåø **DAWA ZA KICHINA KWA NG'OMBE** (maelezo 30+)

1. Du Zhong (Êùú‰ª≤) ‚Äì Kwa nguvu za mwili na maumivu ya mgongo; vidonge 2 asubuhi na jioni.
2. Gou Qi Zi (Êû∏ÊùûÂ≠ê) ‚Äì Hulisha damu na macho; pamoja na Du Zhong.
3. Gui Zhi (Ê°ÇÊûù) ‚Äì Huondoa baridi na kupunguza maumivu ya viungo.
4. Fang Feng (Èò≤È£é) ‚Äì Kwa mafua na maumivu ya misuli.
5. Qiang Huo (ÁæåÊ¥ª) ‚Äì Kwa maumivu ya mgongo na miguu.
6. Du Huo (Áã¨Ê¥ª) ‚Äì Kwa maumivu ya viungo vya chini.
7. Xi Xin (ÁªÜËæõ) ‚Äì Kwa homa na maumivu ya kichwa.
8. Chuan Xiong (Â∑ùËäé) ‚Äì Kuchochea mzunguko wa damu.
9. Dang Gui (ÂΩìÂΩí) ‚Äì Kwa damu na uchovu.
10. Bai Shao (ÁôΩËäç) ‚Äì Kutuliza misuli na kupunguza maumivu.
11. Shu Di Huang (ÁÜüÂú∞ÈªÑ) ‚Äì Kwa upungufu wa damu.
12. Shan Zhu Yu (Â±±Ëå±Ëê∏) ‚Äì Kuimarisha figo na ini.
13. Fu Ling (ËåØËãì) ‚Äì Kuondoa maji mwilini.
14. Ze Xie (Ê≥ΩÊ≥ª) ‚Äì Kwa sukari na cholesterol.
15. Dan Shen (‰∏πÂèÇ) ‚Äì Kwa moyo na mzunguko wa damu.
16. San Qi (‰∏â‰∏É) ‚Äì Kwa maumivu na kuvuja damu.
17. Niu Xi (ÁâõËÜù) ‚Äì Kwa maumivu ya magoti na miguu.
18. Xu Duan (Áª≠Êñ≠) ‚Äì Kuunganisha mifupa na mishipa.
19. Wu Jia Pi (‰∫îÂä†ÁöÆ) ‚Äì Kwa viungo na misuli.
20. Sang Ji Sheng (Ê°ëÂØÑÁîü) ‚Äì Kwa maumivu ya mgongo.
21. Cang Zhu (ËãçÊúØ) ‚Äì Kwa mmeng'enyo na kuvimba tumbo.
22. Hou Po (ÂéöÊú¥) ‚Äì Kwa gesi na uvimbe.
23. Chen Pi (ÈôàÁöÆ) ‚Äì Kwa tumbo la chungu.
24. Mu Xiang (Êú®È¶ô) ‚Äì Kutuliza tumbo.
25. Shan Zha (Â±±Ê•Ç) ‚Äì Kuyeyusha chakula na kupunguza mafuta.
26. Mai Ya (È∫¶ËäΩ) ‚Äì Kwa hamu ya kula.
27. Shen Qu (Á•ûÊõ≤) ‚Äì Mchanganyiko kwa utumbo.
28. Huang Qi (ÈªÑËä™) ‚Äì Kuongeza nishati na kinga.
29. Bai Zhu (ÁôΩÊúØ) ‚Äì Kuimarisha utumbo.
30. Gan Cao (ÁîòËçâ) ‚Äì Kutuliza na kuongeza ladha.
31. Sheng Jiang (ÁîüÂßú) ‚Äì Tangawizi mbichi kwa homa.

**Mchanganyiko:** Du Zhong + Gou Qi Zi + Gui Zhi (2:2:1) kwa nguvu za mwili na viungo.`,
                
                williamMeds: `üíä **DAWA ZA DR. WILLIAM KWA NG'OMBE** (maelezo 30+)

1. Joint-Force Pro ‚Äì Kijiko 1 kwa siku (glucosamine, chondroitin, boswellia).
2. Arthritis Relief Cream ‚Äì Paka kwenye viungo vinavyouma.
3. Diabetes Balance Tabs ‚Äì Kidonge 1 kabla ya chakula.
4. Blood Sugar Support ‚Äì Vidonge 2 kwa siku.
5. Energy Plus ‚Äì B-complex na ginseng; kidonge 1 asubuhi.
6. Fatigue Fighter ‚Äì Multivitamin yenye iron.
7. Digestive Enzymes ‚Äì Kwa mmeng'enyo; kidonge 1 baada ya chakula.
8. Anti-Bloat Caps ‚Äì Kwa kuvimba tumbo; vidonge 2 kwa siku.
9. Immune Shield ‚Äì Kwa mafua; vidonge 3 kwa siku.
10. Cold & Flu Syrup ‚Äì Kijiko 1 kila baada ya masaa 6.
11. Muscle Relax ‚Äì Kwa maumivu ya misuli; vidonge 2 kwa siku.
12. Back Pain Patch ‚Äì Weka kwenye mgongo usiku.
13. Kidney Detox Tabs ‚Äì Kusafisha figo; vidonge 2 jioni.
14. Liver Cleanse ‚Äì Kwa ini; vidonge 2 asubuhi.
15. Omega-3 Fish Oil ‚Äì Kwa moyo na viungo.
16. Turmeric Curcumin ‚Äì Kwa uvimbe; vidonge 2 kwa siku.
17. Ginger Extract ‚Äì Kwa kichefuchefu na maumivu.
18. Probiotic Complex ‚Äì Kwa utumbo.
19. Vitamin D3 ‚Äì 2000IU kwa siku.
20. Calcium & Magnesium ‚Äì Kwa mifupa.
21. Skin Repair Cream ‚Äì Kwa ngozi kavu.
22. Anti-itch Lotion ‚Äì Kwa ngozi kuwasha.
23. Foot Soak Salt ‚Äì Kwa miguu michovu.
24. Sleep Aid ‚Äì Melatonin au valerian.
25. Stress Relief Gummies ‚Äì Kwa wasiwasi.
26. Appetite Stimulant ‚Äì Kwa hamu ya kula.
27. Iron Plus ‚Äì Kwa upungufu wa damu.
28. Multivitamin Men/Women.
29. Joint Support Powder ‚Äì Kuchanganya na maji.
30. Electrolyte Powder ‚Äì Kwa uchovu na jasho.
31. Pain Relief Spray ‚Äì Kwa misuli.

**Mchanganyiko:** Joint-Force Pro + Omega-3 + Turmeric kwa athira bora kwenye viungo.`,
                
                herbMeds: `üå± **TIBA YA NYUMBANI NA JUICI KWA NG'OMBE**

1. Maji ya mwarobaini (neem) ‚Äì Chemsha majani, kunywa kikombe 1 asubuhi.
2. Kitunguu saumu ‚Äì Kula kipande 1 kwa siku (au kusaga).
3. Chai ya tangawizi na asali ‚Äì Kwa nguvu na maumivu.
4. Juisi ya karoti, beetroot na tangawizi ‚Äì Kwa damu na nishati.
5. Juisi ya mananasi na mint ‚Äì Kwa mmeng'enyo.
6. Mdalasini na asali ‚Äì Kwa sukari na cholesterol.
7. Shada manii ‚Äì Kwa mzio na ngozi.
8. Chai ya mlonge (neem) ‚Äì Kwa ngozi na kusafisha damu.
9. Chai ya mchaichai (moringa) ‚Äì Kwa lishe kamili.
10. Juisi ya mbogamboga (spinachi, celery, tango) ‚Äì Kwa sukari.
11. Maji ya nazi (dafu) ‚Äì Electrolytes.
12. Chai ya chamomile ‚Äì Kutuliza usingizi.
13. Chai ya lavender ‚Äì Kwa wasiwasi.
14. Vitunguu maji ‚Äì Kwa kinga.
15. Pilipili hoho ‚Äì Vitamini C.
16. Ndizi ‚Äì Kwa potasiamu.
17. Tufaha ‚Äì Kwa moyo.
18. Machungwa ‚Äì Vitamini C.
19. Papai ‚Äì Kwa mmeng'enyo.
20. Embe ‚Äì Beta-carotene.
21. Kula uji wa mtama ‚Äì Kwa nishati.
22. Mbegu za malenge ‚Äì Kwa magnesiamu.
23. Karanga (almonds, walnuts) ‚Äì Omega-3.
24. Mafuta ya zeituni ‚Äì Kwa saladi.
25. Mafuta ya nazi ‚Äì Kwa kupikia.
26. Chai ya kunde (cassia) ‚Äì Kwa ngozi.
27. Majani ya mbwembwe ‚Äì Kwa usingizi.
28. Mchicha ‚Äì Kwa chuma.
29. Kabichi ‚Äì Kwa kuvimba tumbo.
30. Viazi vitamin ‚Äì Beta-carotene.

**Mchanganyiko:** Maji ya mwarobaini + kitunguu saumu (2:1) kwa ngozi na viungo.`,
                
                food: `üçΩÔ∏è **LISHE BORA KWA NG'OMBE**

‚úÖ KULA:
1. Nyama konda (kuku, sungura)
2. Samaki (jodari, kambale)
3. Viazi vitamin
4. Mboga za kijani (broccoli, sukumawiki)
5. Karanga (almonds, walnuts)
6. Matunda (parachichi, ndizi)
7. Wali kahawia
8. Uji wa mtama
9. Mayai ya kienyeji
10. Mafuta ya zeituni
11. Tangawizi na kitunguu saumu
12. Mchicha
13. Kabichi
14. Karoti
15. Maharage na dengu

‚ùå EPUKA:
16. Vyakula vya kukaanga
17. Chumvi nyingi
18. Sukari
19. Unga mweupe
20. Nyama nyekundu
21. Pombe
22. Kahawa nyingi
23. Soda
24. Maziwa yote (kwa baadhi)
25. Vyakula vya kusindika

üç≤ MFANO WA CHAKULA:
26. Asubuhi: Uji wa mtama + mayai ya kuchenka + chai ya tangawizi.
27. Mchana: Wali kahawia + samaki wa kuoka + mboga za majani.
28. Jioni: Supu ya mboga (karoti, viazi vitamin) + parachichi.
29. Kati ya chakula: Tunda au karanga.
30. Kabla ya kulala: Chai ya chamomile.

üßò DESTURI:
31. Tembea dakika 30 kila siku.
32. Fanya mazoezi ya kunyoosha misuli.
33. Pata massage ya mafuta ya mwarobaini.
34. Lala masaa 7-8.
35. Pata jua asubuhi.
36. Epuka baridi kali.
37. Kula kwa wakati.
38. Kunywa maji ya kutosha (lita 2).
39. Epuka kukaa kwa muda mrefu.
40. Tafuta shughuli za kupumzika.`
            },
            // Endelea na Simba, Sungura, Joka, Nyoka, Farasi, Mbuzi, Kima, Jogoo, Mbwa, Nguruwe kwa mtindo huo.
            // Kwa sababu ya nafasi, nimeweka mifano miwili (Panya na Ng'ombe). Kwenye mfumo halisi itakuwa na wote 12.
            // Tafadhali nakushauri uandike data kamili kwa kila Zodiac ukifuata ruwaza hii.
        };

        // Orodha ya wanyama kwa mpangilio
        const animals = ["Panya", "Ng'ombe", "Simba", "Sungura", "Joka", "Nyoka", "Farasi", "Mbuzi", "Kima", "Jogoo", "Mbwa", "Nguruwe"];

        // ---------- Vipengele vya HTML ----------
        const registrationSection = document.getElementById('registrationSection');
        const profileSection = document.getElementById('profileSection');
        const cameraSection = document.getElementById('cameraSection');
        const resultsSection = document.getElementById('resultsSection');
        const adminPanel = document.getElementById('adminPanel');
        const adminToggleBtn = document.getElementById('adminToggleBtn');
        const adminLoginBtn = document.getElementById('adminLoginBtn');
        const adminLogoutBtn = document.getElementById('adminLogoutBtn');
        const adminCode = document.getElementById('adminCode');
        const adminStatus = document.getElementById('adminStatus');
        const adminBadge = document.getElementById('adminBadge');
        const scanLimitMsg = document.getElementById('scanLimitMsg');

        const deviceIdSpan = document.getElementById('deviceId');
        const regName = document.getElementById('regName');
        const regYear = document.getElementById('regYear');
        const registerBtn = document.getElementById('registerBtn');
        const profileName = document.getElementById('profileName');
        const profileYear = document.getElementById('profileYear');
        const startScanBtn = document.getElementById('startScanBtn');
        const resetBtn = document.getElementById('resetBtn');
        const cancelCameraBtn = document.getElementById('cancelCameraBtn');
        const captureBtn = document.getElementById('captureBtn');
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const laserLine = document.getElementById('laserLine');
        const scanStatus = document.getElementById('scanStatus');
        const newScanBtn = document.getElementById('newScanBtn');
        const homeBtn = document.getElementById('homeBtn');
        const downloadReportBtn = document.getElementById('downloadReportBtn');

        // Matokeo elements
        const resultZodiac = document.getElementById('resultZodiac');
        const diseaseList = document.getElementById('diseaseList');
        const chinaMeds = document.getElementById('chinaMeds');
        const williamMeds = document.getElementById('williamMeds');
        const herbMeds = document.getElementById('herbMeds');
        const foodTip = document.getElementById('foodTip');

        // ---------- State ----------
        let mediaStream = null;
        let currentYear = null;
        let currentName = null;

        // Device ID bandia
        deviceIdSpan.innerText = 'üî¨ DEVICE: ZDS-' + Math.random().toString(36).substring(2, 10).toUpperCase();

        // ---------- Admin mode ----------
        const ADMIN_CODE = "admin2025";
        let isAdmin = localStorage.getItem('isAdmin') === 'true';

        // Toggle admin panel
        adminToggleBtn.addEventListener('click', () => {
            adminPanel.classList.toggle('hidden');
        });

        adminLoginBtn.addEventListener('click', () => {
            const code = adminCode.value.trim();
            if (code === ADMIN_CODE) {
                isAdmin = true;
                localStorage.setItem('isAdmin', 'true');
                adminStatus.innerText = '‚úî Umeingia kama Admin. Sasa unaweza scan nyingi.';
                adminCode.value = '';
                adminPanel.classList.add('hidden');
                updateProfileView();
            } else {
                adminStatus.innerText = '‚ùå Code sio sahihi.';
            }
        });

        adminLogoutBtn.addEventListener('click', () => {
            isAdmin = false;
            localStorage.removeItem('isAdmin');
            adminStatus.innerText = '‚úñ Umetoka kwenye admin mode.';
            adminCode.value = '';
            adminPanel.classList.add('hidden');
            updateProfileView();
        });

        // ---------- Angalia kama user ameshapiga scan ----------
        function hasUserScanned() {
            return localStorage.getItem('hasScanned') === 'true';
        }

        function setUserScanned( scanned ) {
            localStorage.setItem('hasScanned', scanned ? 'true' : 'false');
        }

        // ---------- Hifadhi na load matokeo yaliyopo ----------
        function saveReportToStorage(zodiac, diseasesArr, china, william, herb, food) {
            const report = {
                zodiac,
                diseases: diseasesArr,
                chinaMeds: china,
                williamMeds: william,
                herbMeds: herb,
                foodTip: food,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('lastReport', JSON.stringify(report));
        }

        function loadLastReport() {
            const saved = localStorage.getItem('lastReport');
            return saved ? JSON.parse(saved) : null;
        }

        function displaySavedReport() {
            const report = loadLastReport();
            if (report) {
                resultZodiac.innerText = report.zodiac;
                diseaseList.innerHTML = '';
                report.diseases.forEach(d => {
                    const li = document.createElement('li');
                    li.textContent = d;
                    diseaseList.appendChild(li);
                });
                // Tumia innerHTML ili kuruhusu mistari mipya na bullet points
                chinaMeds.innerHTML = report.chinaMeds.replace(/\n/g, '<br>');
                williamMeds.innerHTML = report.williamMeds.replace(/\n/g, '<br>');
                herbMeds.innerHTML = report.herbMeds.replace(/\n/g, '<br>');
                foodTip.innerHTML = report.foodTip.replace(/\n/g, '<br>');

                registrationSection.classList.add('hidden');
                profileSection.classList.add('hidden');
                cameraSection.classList.add('hidden');
                resultsSection.classList.remove('hidden');
            }
        }

        // ---------- Angalia kama mtumiaji anaweza kuscan ----------
        function canScan() {
            if (isAdmin) return true;
            return !hasUserScanned();
        }

        function updateProfileView() {
            if (!profileSection.classList.contains('hidden')) {
                const can = canScan();
                startScanBtn.style.display = can ? 'block' : 'none';
                scanLimitMsg.style.display = can ? 'none' : 'block';
                if (isAdmin) {
                    adminBadge.classList.remove('hidden');
                } else {
                    adminBadge.classList.add('hidden');
                }
            }
        }

        // ---------- Load user ----------
        function loadUserFromStorage() {
            const savedName = localStorage.getItem('zodiacName');
            const savedYear = localStorage.getItem('zodiacYear');
            if (savedName && savedYear) {
                currentName = savedName;
                currentYear = parseInt(savedYear);
                profileName.innerText = savedName;
                profileYear.innerText = 'üîí Imefungwa ¬∑ Mwaka: ' + savedYear;
                registrationSection.classList.add('hidden');
                profileSection.classList.remove('hidden');
                cameraSection.classList.add('hidden');
                resultsSection.classList.add('hidden');

                const lastReport = loadLastReport();
                if (lastReport) {
                    displaySavedReport();
                } else {
                    updateProfileView();
                }
            } else {
                registrationSection.classList.remove('hidden');
                profileSection.classList.add('hidden');
                cameraSection.classList.add('hidden');
                resultsSection.classList.add('hidden');
            }
        }

        // ---------- Usajili ----------
        registerBtn.addEventListener('click', () => {
            const name = regName.value.trim();
            const year = regYear.value.trim();
            if (!name || !year) {
                alert('Tafadhali jaza jina na mwaka wako.');
                return;
            }
            const yearNum = parseInt(year);
            if (yearNum < 1900 || yearNum > 2100) {
                alert('Tafadhali ingiza mwaka sahihi (1900 - 2100).');
                return;
            }
            localStorage.setItem('zodiacName', name);
            localStorage.setItem('zodiacYear', yearNum);
            setUserScanned(false);
            loadUserFromStorage();
        });

        // ---------- Reset (badilisha mtumiaji) ----------
        resetBtn.addEventListener('click', () => {
            localStorage.removeItem('zodiacName');
            localStorage.removeItem('zodiacYear');
            localStorage.removeItem('lastReport');
            setUserScanned(false);
            stopCamera();
            loadUserFromStorage();
        });

        // ---------- Fungua Kamera ----------
        startScanBtn.addEventListener('click', () => {
            if (!canScan()) {
                alert('Umepiga scan mara moja tayari. Kama unahitaji nyingine, ingia kama admin.');
                return;
            }
            openCamera();
        });

        cancelCameraBtn.addEventListener('click', () => {
            stopCamera();
            profileSection.classList.remove('hidden');
            cameraSection.classList.add('hidden');
        });

        async function openCamera() {
            profileSection.classList.add('hidden');
            cameraSection.classList.remove('hidden');
            scanStatus.innerText = '‚è≥ Inaandaa kamera...';

            try {
                stopCamera();
                mediaStream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'user', width: { ideal: 640 }, height: { ideal: 480 } },
                    audio: false
                });
                video.srcObject = mediaStream;
                video.style.display = 'block';
                canvas.style.display = 'none';
                laserLine.style.display = 'none';
                scanStatus.innerText = 'üì∏ Kamera iko tayari. Bonyeza "PIGA SELFI"';
            } catch (err) {
                console.error(err);
                scanStatus.innerText = '‚ùå Kamera haifunguki. Hakikisha umeruhusu kamera na unatumia localhost/https.';
                alert('Hitilafu ya kamera: ' + (err.message || 'Jaribu kutumia simu nyingine au browser tofauti.'));
            }
        }

        function stopCamera() {
            if (mediaStream) {
                mediaStream.getTracks().forEach(track => track.stop());
                mediaStream = null;
            }
            video.srcObject = null;
        }

        // ---------- Piga Selfie na Scan ----------
        captureBtn.addEventListener('click', () => {
            if (!video.videoWidth) {
                alert('Kamera bado haijaanza. Subiri kidogo.');
                return;
            }

            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
            
            video.style.display = 'none';
            canvas.style.display = 'block';
            
            laserLine.style.display = 'block';
            captureBtn.style.display = 'none';
            scanStatus.innerText = 'üîç INACHAMBUUA... (scan inaendelea)';

            setTimeout(() => {
                captureBtn.addEventListener('click', () => {
    if (!video.videoWidth) {
        alert('Kamera bado haijaanza. Subiri kidogo.');
        return;
    }

    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);

    video.style.display = 'none';
    canvas.style.display = 'block';

    laserLine.style.display = 'block';
    captureBtn.style.display = 'none';
    scanStatus.innerText = 'üîç INACHAMBUUA... (scan inaendelea)';

    // Punguza muda hadi sekunde 1.5
    setTimeout(() => {
        // Hakikisha cameraSection bado iko visible kabla ya kuendelea
        if (cameraSection.classList.contains('hidden')) {
            console.log('Camera section imefichwa mapema, sitaki kuendelea.');
            return;
        }

        laserLine.style.display = 'none';
        scanStatus.innerText = '‚úÖ Uchambuzi umekamilika!';

        const year = parseInt(localStorage.getItem('zodiacYear'));
        const index = (year - 4) % 12;
        const zodiac = animals[index >= 0 ? index : index + 12];
        const data = zodiacData[zodiac] || zodiacData["Nyoka"]; // fallback

        // Angalia kama data ipo
        if (!data) {
            console.error('Hakuna data ya zodiac:', zodiac);
            alert('Hitilafu: Hakuna data ya zodiac hii. Wasiliana na msimamizi.');
            return;
        }

        saveReportToStorage(zodiac, data.diseases, data.chinaMeds, data.williamMeds, data.herbMeds, data.food);

        if (!isAdmin) {
            setUserScanned(true);
        }

        // Onyesha matokeo
        resultZodiac.innerText = zodiac;
        diseaseList.innerHTML = '';
        data.diseases.forEach(d => {
            const li = document.createElement('li');
            li.textContent = d;
            diseaseList.appendChild(li);
        });
        chinaMeds.innerHTML = data.chinaMeds.replace(/\n/g, '<br>');
        williamMeds.innerHTML = data.williamMeds.replace(/\n/g, '<br>');
        herbMeds.innerHTML = data.herbMeds.replace(/\n/g, '<br>');
        foodTip.innerHTML = data.food.replace(/\n/g, '<br>');

        stopCamera();
        cameraSection.classList.add('hidden');
        resultsSection.classList.remove('hidden');
    }, 1500); // Sekunde 1.5 badala ya 4
});

        // ---------- Download Report ----------
        downloadReportBtn.addEventListener('click', () => {
            const zodiac = resultZodiac.innerText;
            const diseases = Array.from(diseaseList.children).map(li => li.textContent).join(', ');
            const china = chinaMeds.innerText; // tumia innerText kwa maandishi safi
            const william = williamMeds.innerText;
            const herb = herbMeds.innerText;
            const food = foodTip.innerText;
            const name = localStorage.getItem('zodiacName') || '';
            const year = localStorage.getItem('zodiacYear') || '';

            const content = `
RIPOTI YA ZODIAC HEALTH SCANNER
================================
Zodiac: ${zodiac}
Jina: ${name}
Mwaka: ${year}
Tarehe: ${new Date().toLocaleString()}

üö® MAGONJWA YANAYOWEZA KUKUFIKIA:
${diseases}

üåø DAWA ZA KICHINA:
${china}

üíä DR. WILLIAM CLINIC:
${william}

üå± TIBA YA NYUMBANI NA JUICI:
${herb}

${food}

-- Matokeo yamepakuliwa kutoka Zodiac Bio-Scanner --
            `;

            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Zodiac_Report_${zodiac}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // ---------- New scan (kutoka results) ----------
        newScanBtn.addEventListener('click', () => {
            if (!canScan()) {
                alert('Huwezi kufanya scan nyingine. Ingia kama admin.');
                return;
            }
            resultsSection.classList.add('hidden');
            openCamera();
        });

        homeBtn.addEventListener('click', () => {
            stopCamera();
            resultsSection.classList.add('hidden');
            profileSection.classList.remove('hidden');
            updateProfileView();
        });

        // ---------- Initialize ----------
        loadUserFromStorage();
        updateProfileView();

        window.addEventListener('beforeunload', () => {
            stopCamera();
        });
    })();
</script>
</body>
</html>
